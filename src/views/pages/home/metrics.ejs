<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="robots" content="all" />
    <meta property="og:locale" content="en_US">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:title" content="CrabGame Cheat" />
    <meta property="og:site_name" content="CrabGame Cheat" />
    <meta property="og:image" height="64px" content="/public/img/icon.png">
    <meta property="og:description" content="A working, free & undetectable mod for CrabGame. ESP, Godmode, Fly & more.">
    <meta property="og:type" content="website" />
    <meta name="description" content="A working, free & undetectable mod for CrabGame. ESP, Godmode, Fly & more.">
    <meta name="keywords" content="CrabGame, SquidGame, CrabMod">
    <meta name="author" content="CrabGame Cheat">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@CrabGame Cheat">
    <meta name="twitter:creator" content="@CrabGame Cheat">
</head>
<%- include('../../Components/HomeNavbar', { user }) %>
<title>CrabMod | Metrics</title>
<script src="https://cdn.jsdelivr.net/npm/kute.js@2.1.2/dist/kute.min.js"></script>
<link rel="stylesheet" href="/public/css/fontawesome-min.css" />
<link rel="stylesheet" href="/public/css/home.css" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<body>
  <section class="blue flex-column new-style">
    <div style="display: flex; align-items: center;">
      <div style="z-index: 100;" style="text-align: center;">
          <h1 class="title-upper" style="text-align: center;">Metrics</h1>
          <p class="mt-1">Statistics and player information</p>
      </div>
    </div>
  </section>
  
  <div class="spacer layer2 flip" style="z-index: 999 !important;"></div>

  <section class="purple image-align" id="1st">
    <div style="display: flex; text-align: center; height: 250px; align-items: center;justify-content: center;flex-direction: column;">
        <div>
            <h2 class="m-0">Statistics</h2>
            <p id="updates-in">Refreshing...</p>
            <div style="display: flex;">
                <div class="background-2 m-1">
                    <h4>Active Players</h4>
                    <p id="realtime-player-count">...</p>
                </div>
                <div class="background-2 m-1">
                    <h4>Unique Players</h4>
                    <p id="unique-player-count">...</p>
                </div>
                <div class="background-2 m-1">
                    <h4>Players in Games</h4>
                    <p id="realtime-player-count-lobbys">...</p>
                </div>
            </div>
        </div>
    </div>
    
  </section>

  <div class="spacer layer2" style="z-index: 999 !important;"></div>
  <%- include('../../Components/Footer') %>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.js"></script>

  <script>
    (() => {
    const hamburger = document.getElementById("hamburger");
    const menu = document.getElementById("nav_overlay");
    let open = false;

    const change = () => {
      if (!open) {
        hamburger.classList.add("open");
        menu.classList.add("d-flex");
        document.body.classList.add("no-scroll");
      } else {
        hamburger.classList.remove("open");
        menu.classList.remove("d-flex");
        document.body.classList.remove("no-scroll");
      }
      open = !open;
    };

    hamburger.addEventListener("click", change);

    const delay = ms => new Promise(res => setTimeout(res, ms));

    function getLiveData() {
        $.ajax({
          url: "/api/v1/live",
          method: "GET",
          dataType: "json",
          crossDomain: true,
          contentType: "application/json; charset=utf-8",
          cache: true,
          timeout: 10000,
          success: function (data) {
            $("#realtime-player-count").text(`${data.players_online}`);
            $("#realtime-player-count-lobbys").text(`${data.players_in_lobby}`);
          },
          error: function (jqXHR, textStatus, errorThrown) {
          }
        });
        $.ajax({
          url: "/api/v1/total_users_count",
          method: "GET",
          dataType: "json",
          crossDomain: true,
          contentType: "application/json; charset=utf-8",
          cache: true,
          timeout: 10000,
          success: function (data) {
            $("#unique-player-count").text(`${data.number}`);
          },
          error: function (jqXHR, textStatus, errorThrown) {
          }
        });
      }

      i = 10

      function timer() {
       setInterval(async function(){
           if (i == 0) {
               getLiveData();
               $('#updates-in').text(`Refreshing...`);
               i = 10;
           } else {
            $('#updates-in').text(`Updates in ${i} sec.`);
           }
           i--
       }, 1000);
      }
      timer()
      getLiveData()

    })();

  </script>

</body>
</html>